<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  
  <!--[if lt IE 9]>
  <script src="/lib/html5shim.js"></script>
  <![endif]-->  
  
  <!-- These are some core styles the slideshow app requires -->
  <link rel="stylesheet" href="/lib/styles.css" />
  
  <!-- These are the styles you'll add to make the slides look great -->
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/prism.css" />
  
  <title>x86 Assembly Language</title>
</head>
<body class="language-nasm">
  <header>
      <h1>Hello World Walkthrough (line-by-line)</h1>
    <nav>
      <ul>
        <li><button id="prev-btn" title="Previous slide">Previous Slide</button></li>
        <li><span id="slide-number"></span>/<span id="slide-total"></span></li>
        <li><button id="next-btn" title="Next Slide">Next Slide</button></li>
      </ul>
    </nav>
  </header>
  <div id="deck">
    <section>
      <hgroup>
        <h1>Hello World Walkthrough</h1>
        <h2>Line-by-Line Explanation</h2>
        <h2>USNA IWG</h2>
      </hgroup>
    </section>
    <section>
      <hgroup>
        <h1>About these slides</h1>
      </hgroup>
      <div style="float:left">
        <ul>
          <li>This presentation goes through a sample Hello World program, line by line</li>
          <li>For the actual code, there will be a stack diagram to the right</li>
          <li>For stack diagrams, higher addresses are highest on the diagram</li>
          <li>Similarly, the top of the stack is at the bottom of the diagram</li>
          <li>The first slide has all the code on it - copy that into a text editor for
          easy reference</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/stack_overview.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1>First, all the code:</h1>
      </hgroup>
<pre><code>
[BITS 32]

section .data:
    msg:    db `Hello, World!\n\0`  ; use backticks for the string
                                    ; note that we need to manually add the \0

section .text:
    extern printf           ; have to declare what functions we use
    global main             ; main is a global symbol (accessible from other files)

main:
    push ebp                ; standard prologue
    mov ebp, esp            ;
    push msg                ; push msg onto the stack (to use as an arg)
    call printf             ; printf(msg)
    add esp, 4              ; clean up the arg we pushed
    mov eax, 0              ; put return code in eax
    mov esp, ebp            ; standard epilogue
    pop ebp                 ;
    ret                     ;
</code></pre>
    </section>
    <section>
      <hgroup>
        <h1><code>[BITS 32]</code></h1>
      </hgroup>
      <ul>
        <li>Tells the assembler we are writing 32-bit code</li>
        <li>Could also be <code>[BITS 16]</code>, <code>[BITS 64]</code></li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>section .data:</code></h1>
      </hgroup>
      <ul>
        <li>Begins the data section</li>
        <li>This is where all global variables are stored</li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>msg: db `Hello, World!\n\0`</code></h1>
      </hgroup>
      <ul>
        <li>Defines a global variable msg</li>
        <li>The <code>msg:</code> part defines a label.  Labels are like pointers to memory inside
            our program.</li>
        <li>The <code>db</code> directive tells the assembler to place actual values into the
        program's memory.  It stands for Define Byte.</li>
        <li>It places the sequence of bytes `Hello, World\n\0` into the program's memory.  Note
        that you MUST use backticks (`) with this assembler.</li>
        <li>Note that you have to manually null-terminate the string</li>
        <li>Other instructions you can use in the .data section to define global variables include
        <code>dw</code> (Define Word, 16 bit values) and <code>dd</code> (Define Doubleword, 32 bits).</li>
        <li>So, this line is equivalent to <code class="language-c">char* msg = "Hello, World!\n";</code></li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>section .text:</code></h1>
      </hgroup>
      <ul>
        <li>Begins the text section</li>
        <li>This is where all of the code resides</li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>extern printf</code></h1>
      </hgroup>
      <ul>
        <li>Tells the assembler that another file defines printf</li>
        <li>We don't have #include files in assembly, but we still need to say what
        functions we are using</li>
        <li>Prevents errors from the assembler saying that it can't find printf in
        our program</li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>global main</code></h1>
      </hgroup>
      <ul>
        <li>Tells the assembler that we want main to be a global symbol</li>
        <li>By default, the assembler removes all of our labels/symbols when it
        assembles our program</li>
        <li>However, the OS needs to be able to reference main when it loads our program</li>
        <li>Basically: if a function or variable needs to be referenced outside the current
        assembly file, you need to make it a global symbol</li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>main:</code></h1>
      </hgroup>
      <ul>
          <li>Defines another label, called main</li>
          <li>This label, instead of pointing to data like msg, points to code (our main function)</li>
      </ul>
    </section>
    <section>
      <hgroup>
        <h1><code>push ebp</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>This pushes the last function's block pointer onto
            the stack</li>
            <li>This is part of the standard function prologue</li>
            <li>Need to save ebp because we will overwrite ebp, and
            the caller expects ebp to be preserved</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/push_ebp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>mov ebp, esp</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>This sets ebp to point to the top of the stack</li>
            <li>Provides us with a fixed location to reference local
            memory from (esp changes)</li>
            <li>Notice how ebp now points to the saved ebp</li>
            <li>In this way, ebp forms a sort of linked-list</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/mov_ebp_esp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>push msg</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>This pushes the value of the msg label onto the stack</li>
            <li>Labels are pointers</li>
            <li>So, the variable at the top of the stack points to our message</li>
            <li>We are pushing this onto the stack to use as an argument</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/push_msg.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>call printf</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>This calls printf() in the c library (libc)</li>
            <li>Recall: arguments are passed on the stack</li>
            <li>So, this is equivalent to <code>printf(msg);</code></li>
            <li>printf() will return to the next instruction</li>
            <li>Recall: return value will be in eax</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/push_msg.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>add esp, 4</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>printf() has returned</li>
            <li>Its return code is in eax (but we don't care)</li>
            <li>Now, we need to clean up the stack</li>
            <li>Recall: in x86 it is the caller's responsibility to remove args
            from the stack</li>
            <li>Recall: adding 4 to esp effectively removes one item from the stack</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/mov_ebp_esp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>mov eax, 0</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>Putting the return code for main() into eax</li>
            <li>Necessary because we don't know what printf() will put there</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/mov_ebp_esp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>mov esp, ebp</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>Part of the standard epilogue</li>
            <li>Clears any local variable space we may have allocated</li>
            <li>Since we have not allocated any stack space - doesn't do anything</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/mov_ebp_esp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>pop ebp</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>Restores the saved base pointer (ebp)</li>
            <li>Removes saved base pointer from the stack</li>
            <li>Sets up the stack frame for a return</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/pop_ebp.svg" />
      <div style="clear:both"></div>
    </section>
    <section>
      <hgroup>
        <h1><code>ret</code></h1>
      </hgroup>
      <div style="float:left">
        <ul>
            <li>Return to the caller</li>
            <li>Return code in eax: 0</li>
            <li>main(): returns to startup code that calls exit()</li>
        </ul>
      </div>
      <img style="float:left;margin-left:10em" src="/images/ret.svg" />
      <div style="clear:both"></div>
    </section>
  </div>
  <!-- /deck -->
  <script src="/lib/jquery-1.5.2.min.js"></script>
  <script src="/lib/jquery.jswipe-0.1.2.js"></script>  
  <script src="/lib/htmlSlides.js"></script>
  <script src="/lib/prism.js"></script>
  <script src="/lib/trim.js"></script>
  <script>
    //Do our business when the DOM is ready for us
    $(function() {
      
      //One little option: hideToolbar (boolean; default = false)
      htmlSlides.init({ hideToolbar: true });
      
    });
  </script>
  </body>
</html>
